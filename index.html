<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Бот-таролог онлайн</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header class="header">
    <span>Выберите карты</span>
</header>

<main class="main">
    <div class="main-images">
        <!-- Карты -->
        <div class="main-image" onclick="flipCard(this)">
            <div class="card">
                <div class="card-face card-back">
                    <img src="images/backpurple.jpg" alt="Рубашка карты">
                </div>
                <div class="card-face card-front"></div>
            </div>
        </div>
        <!-- Карты -->
        <div class="main-image" onclick="flipCard(this)">
            <div class="card">
                <div class="card-face card-back">
                    <img src="images/backpurple.jpg" alt="Рубашка карты">
                </div>
                <div class="card-face card-front"></div>
            </div>
        </div>
        <!-- Карты -->
        <div class="main-image" onclick="flipCard(this)">
            <div class="card">
                <div class="card-face card-back">
                    <img src="images/backpurple.jpg" alt="Рубашка карты">
                </div>
                <div class="card-face card-front"></div>
            </div>
        </div>
        <!-- Карты -->
        <div class="main-image" onclick="flipCard(this)">
            <div class="card">
                <div class="card-face card-back">
                    <img src="images/backpurple.jpg" alt="Рубашка карты">
                </div>
                <div class="card-face card-front"></div>
            </div>
        </div>
        <!-- Карты -->
        <div class="main-image" onclick="flipCard(this)">
            <div class="card">
                <div class="card-face card-back">
                    <img src="images/backpurple.jpg" alt="Рубашка карты">
                </div>
                <div class="card-face card-front"></div>
            </div>
        </div>
        <!-- Карты -->
        <div class="main-image" onclick="flipCard(this)">
            <div class="card">
                <div class="card-face card-back">
                    <img src="images/backpurple.jpg" alt="Рубашка карты">
                </div>
                <div class="card-face card-front"></div>
            </div>
        </div>
    </div>
    <!-- Кнопка отправки карт -->
<!--    <button id="sendCardsButton" style="display:none;">Отправить карты</button>-->
</main>

<script>
    const tg = window.Telegram.WebApp;

    const cardImages = [
        "images/RWS_Tarot_00_Fool.jpg",
        "images/RWS_Tarot_01_Magician.jpg",
        "images/RWS_Tarot_02_High_Priestess.jpg",
        "images/RWS_Tarot_03_Empress.jpg",
        "images/RWS_Tarot_04_Emperor.jpg",
        "images/RWS_Tarot_05_Hierophant.jpg"
    ];

    const maxFlippedCards = 3;
    let flippedCardsCount = 0;
    let selectedCards = [];

    // Инициализируем mainButton
    tg.MainButton.text = "Отправить карты";
    tg.MainButton.setParams({ color: '#592197' }); // Цвет кнопки
    tg.MainButton.hide(); // Скрываем кнопку до выбора 3 карт

    // Функция переворота карты
    function flipCard(cardElement) {
        const card = cardElement.querySelector('.card');

        if (card.classList.contains('flipped') || flippedCardsCount >= maxFlippedCards) {
            return; // Возвращаемся, если карта уже перевернута или достигнуто максимальное количество
        }

        flippedCardsCount += 1;
        const frontFace = cardElement.querySelector('.card-front img');
        if (!frontFace) {
            const imgElement = document.createElement('img');
            const randomCard = getRandomCard();
            imgElement.src = randomCard;
            selectedCards.push(randomCard.split('/').pop().replace('.jpg', '')); // Сохраняем название карты
            cardElement.querySelector('.card-front').appendChild(imgElement);
            console.log(`Карта перевернута: ${randomCard.split('/').pop()}`); // Лог перевернутой карты
        }

        card.classList.add('flipped');

        // Показываем MainButton и HTML кнопку, если выбрано 3 карты
        if (flippedCardsCount === maxFlippedCards) {
            tg.MainButton.show();
            document.getElementById('sendCardsButton').style.display = 'block'; // Показываем HTML кнопку
        }
    }

    // Функция для получения случайной карты
    function getRandomCard() {
        const randomIndex = Math.floor(Math.random() * cardImages.length);
        const selectedCard = cardImages[randomIndex];
        cardImages.splice(randomIndex, 1); // Удаляем карту из массива
        return selectedCard;
    }

    // Когда нажата основная кнопка Telegram
    tg.MainButton.onClick(function () {
        const selectedCardNames = selectedCards.join(',');

        if (selectedCardNames.length === 0) {
            console.error("Нет выбранных карт для отправки");
            return;
        }

        // Отправляем данные в Telegram
        tg.sendData(selectedCardNames); // Отправляем только названия карт через запятую
        console.log("Карты отправлены в Telegram:", selectedCardNames);

        // Закрываем мини-приложение
        tg.close();
    });

    // Когда нажата HTML кнопка "Отправить карты"
    document.getElementById('sendCardsButton').addEventListener('click', function () {
        const selectedCardNames = selectedCards.join(',');

        if (selectedCardNames.length === 0) {
            console.error("Нет выбранных карт для отправки");
            return;
        }

        // Логируем данные в консоль для отладки
        console.log("Карты отправлены через HTML кнопку:", selectedCardNames);

        // Можно сделать любое действие, например, отправить на сервер или просто показать сообщение
        alert(`Вы отправили карты: ${selectedCardNames}`);
    });
</script>

</body>
</html>